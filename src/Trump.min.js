(function(){function e(e){if(!log){var t=function(){};window.log={trace:t,warn:t,debug:t,error:t,setLevel:t,levels:{}}}log.trace(D,"Initialised"),e=e||{};var n=null;return SAL&&SAL.Template?diffDOM||(n="Did not initialise as DiffDOM did not load."):n="Did not initialise as we require SAL.Template for now.",n?(log.error(D,n),!1):(void 0!==e.logLevel&&log.setLevel(e.logLevel),e.prefix&&e.prefix.trim()&&(A.prefix=e.prefix),A.eventAttributeName=A.prefix+"-event",A.eventUuidAttributeName=A.eventAttributeName+"-uuid",A.mountElementUuidAttributeName=A.prefix+"-mount-uuid",!0)}function t(e,t,r){var a=null;if(e?t?r||(r={},log.warn(D,"You haven't passed any data through for your template.")):a="You must provide the ID of the template you are wanting to render.":a="You must provide the element ID of the element you wish to mount the changes to.",a)return log.error(D,a),!1;var i=document.getElementById(e);if(!i)return log.error(D,"Could not find mount element with ID",e),!1;var u=A.mountElementUuidAttributeName,l=i.attributes[u];l&&w[d]&&delete w[d];var d=g(),v=w[d]={mountElementID:e,templateID:t,templateData:r},f=v.templateData.eventHandlers;for(var m in f)f[m].uuid&&delete f[m].uuid;i.setAttribute(u,d);var s=SAL.Template.render(t,v.templateData.data||{});return o(i,s,f,d),{update:function(e){n(d,e)}}}function n(e,t){if(!e)return!1;var n=w[e];if(!n)return log.debug(D,"No data was found for any element with UUID",e),!1;var r=document.getElementById(n.mountElementID);if(!r)return log.error(D,"Could not find mount element with ID",n.mountElementID),!1;t=t||{},n.templateData.data=h(n.templateData.data,t.data),n.templateData.eventHandlers=h(n.templateData.eventHandlers,t.eventHandlers);var a=SAL.Template.render(n.templateID,n.templateData.data||{});return o(r,a,n.templateData.eventHandlers,e),!0}function r(e){if(!e)return!1;for(var t=0,n=e.length;t<n;t++){var r=e[t];switch(r.action){case"removeElement":a(r);break;case"modifyAttribute":r.name==A.eventUuidAttributeName&&l(r.oldValue),r.name==A.mountElementUuidAttributeName&&w[r.oldValue]&&delete w[currentMountElementUuid]}}return!0}function a(e){var t=e.element;if(t){for(var n=i([t],A.eventUuidAttributeName),r=i([t],A.mountElementUuidAttributeName),a=0,o=n.length;a<o;a++)l(n[a]);for(a=0,o=r.length;a<o;a++){var u=r[a];w[u]&&delete w[u]}}}function i(e,t){for(var n=[],r=0,a=e.length;r<a;r++){var o=e[r];o.attributes&&o.attributes[t]&&n.push(o.attributes[t]),o.childNodes&&o.childNodes.length>0&&(n=n.concat(i(o.childNodes,t)))}return n}function o(e,t,n,a){var i=e.cloneNode(),o=new diffDOM;i.innerHTML=t,u(i,n,a);var l=o.diff(e,i);r(l),log.debug(D,"Differences:",l),o.apply(e,l),log.debug(D,"Differences applied to DOM.")}function u(e,t,n){var r=A.eventAttributeName,a=e.querySelectorAll("["+r+"]");t=t||{},log.debug(D,"Elements found for event bindings",a);for(var i=0,o=a.length;i<o;i++){var u=a[i],l=u.attributes[r].value,v=d(l),m=g();if(v)for(var s=0,p=v.length;s<p;s++){var c=v[s],h=t[c.eventFnName];h&&"function"==typeof h?(m=h.uuid||m,f(m,c.eventType,h,n),h.uuid=m,u.setAttribute(A.eventUuidAttributeName,m)):log.warn(D,"Could not find event handler",c.eventFnName,"within event handlers that were passed in.")}u.removeAttribute(r)}}function l(e){x[e]&&(log.debug(D,"Removing event with UUID",e,x[e]),delete x[e])}function d(e){var t=/^\s*[a-zA-Z]+\s*\:\s*\w+\s*$/,n=/^\s*[a-zA-Z]+\s*\:\s*\w+\s*(,\s*[a-zA-Z]+\s*\:\s*\w+\s*)+$/,r=!1;if(t.test(e))r=[v(e)];else if(n.test(e)){var a=e.split(",");r=[];for(var i=0,o=a.length;i<o;i++)r.push(v(a[i]))}else log.warn(D,"The element doesn't have the correct syntax for event binding.  It must be formatted with the event type, colon, then name of function.  e.g. click:handler_click.",e);return r}function v(e){var t=e.split(":"),n=t[0]||"",r=t[1]||"";return{eventType:n.trim().toLowerCase(),eventFnName:r.trim()}}function f(e,t,n,r){if(x[e]&&x[e].eventType==t)return log.warn(D,"Another event handler with the same UUID and event type was found.  This event will not be bound...",e),!1;m(t);var a=x[e],i=Array.isArray(a),o={eventType:t,eventHandlerFn:n,elMountUuid:r};return"object"!=typeof a||i?i?x[e].push(o):x[e]={eventType:t,eventHandlerFn:n,elMountUuid:r}:x[e]=[a,o],!0}function m(e){y[e]||(log.debug(D,"No delegate event handler was found for type",e,"creating one now."),y[e]=s(e))}function s(e){return document.addEventListener(e,p,!0),log.debug(D,"Created delegate event handler for type",e),!0}function p(e){for(var t=e.target,n=!1;null!=t&&(n===!1||void 0===n);){var r=t.attributes[A.eventUuidAttributeName];r&&r.value&&(n=c(r.value,e,t)),t=t.parentElement}}function c(e,t,r){var a=x[e],i=Array.isArray(a),o=t.type;if(!a||"object"==typeof a&&!i&&a.eventType!=o)return!1;if(i){for(var u=!1,l=0,d=a.length;l<d;l++){a[l];if(a[l].eventType==o){a=a[l],u=!0;break}}if(!u)return!1}r.update=function(e){n(a.elMountUuid,e)};var v=0==a.eventHandlerFn.call(r,t);return log.debug(D,"Event handler found and invoked.","Event Handler:",a),v}function g(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}function h(e,t){if(e&&t)for(var n in t)e[n]=t[n];return e}var b={},x={},y={},w={},D="Trump Says:",A={prefix:"trump",renderFn:function(){}};b.init=e,b.applyToDOM=t,window.Trump=b})();